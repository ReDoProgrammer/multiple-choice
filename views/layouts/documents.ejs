<div class="panel panel-success">
  <div class="panel-heading" style="padding-top:5px; padding-bottom:5px;">
    <% if(group && subject){%>
      <div class="row">
        <h3 class="panel-title" style = "text-align:left; text-transform: uppercase; margin-top:5px; padding-top:5px; padding-bottom:5px;"><i class="fa fa-book text-danger" aria-hidden="true"></i> Tài liệu liên quan </h3>
      </div>
      <%}else{%>
        <h3 class="panel-title"  style = "text-align:left; text-transform: uppercase; margin-top:5px; padding-top:5px; padding-bottom:5px;"><i class="fa fa-book text-danger" aria-hidden="true"></i> Tin tức nổi bật</h3>
        <%}%>

      </div>
      <div class="panel-body" id="documents">
        <% if(group && subject){%>
          <div class="row">
            <div class="col-sm-10 text-center">
              <h4 class="text-info">Thông tin bài làm: <span class="text-warning">45 phút</span>. Số câu hỏi: <span class="text-danger">55</span></h4>
            </div>
            <div class="col-sm-2 text-center">
              <button type="button" class="btn btn-success" id="btnDoExam">Làm bài thi</button>
            </div>
          </div>
          <%}else{%>
            <%- include ('../news/hot-news') %>
            <%}%>

            <hr>
            <div class="row">
              <div class="col-sm-12" id="summary">

              </div>
            </div>
            <div class="row">
              <div class="col-sm-12" id="doc-summary">
              </div>
            </div>
          </div>
        </div>

<script type="text/javascript">
$('#btnDoExam').click(function(){
var url = window.location.href;
window.location.href = url.replace('view','lam-bai-thi');
});

$(document).ready(function(){
let group='',subject = '';
var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
if(hashes.length==2){
  group =(hashes[0].split('='))[1];
  subject = (hashes[1].split('='))[1];
}
$.ajax({
  url:'/summary',
  type:'get',
  data:{
    group:group,
    subject:subject
  },
  success:function(data){
    let content = '<p>Câu hỏi trong mỗi bài thi được lấy ngẫu nhiên từ <span class="text-danger">'+data.count+'</span> câu hỏi từ <span class="text-info">'+data.subject.description+'</span></p>';
    $('#summary').html(content);
  }
});

$.ajax({
  url:'/admin/document/list-by-subject',
  type:'get',
  data:{
    group:group,
    subject:subject
  },
  success:function(data){
    if(data.code == 200 && data.documents.length >0){
      // $('#doc-summary').append('<h4 class="text-uppercase">Tài liệu liên quan</h4>');
      // console.log(data.documents);
      let documents = '<ul class="list-group">'
        documents +=  '<li class="list-group-item disabled active"><span class = "text-warning" style="font-weight:bold; padding:10px;">TÀI LIỆU LIÊN QUAN</span></li>';
        $.each(data.documents,function(k,v){
          documents +=   '<li class="list-group-item">';
            documents +=  '<h4>'+v.doctype.icon+' <a href="'+v.link+'" target="_blank">'+v.name+'</a></h4>';
            documents += '<p style="margin-left:20px;">'+v.description+'</p>';
            documents += '</li>';
          });
          documents +=  '</ul>';
          $('#doc-summary').html(documents);
        }
      }
    });
  });
</script>
